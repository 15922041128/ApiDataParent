<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    <meta charset="UTF-8">
    <title>YINGZE</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">



<!--[if lt IE 9]>
<script src="/themes/v5/public/js/html5shiv.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/themes/v5/public/js/respond.min.js" type="text/javascript" charset="utf-8"></script>
<![endif]-->
<!--[if IE 6]>
<script src="/themes/v5/public/js/DD_belatedPNG_0.0.8a.js"  type="text/javascript"></script>
<script>DD_belatedPNG.fix('.centerIcon');</script>
<![endif]-->


<link media="all" href="css/396396_001.css" type="text/css" rel="stylesheet">
<link rel="stylesheet" href="css/layer.css" id="layui_layer_skinlayercss" style=""></head>
<body>
    <header class="clearfix">
    <a href="default.html" class="centerLogo" target="_top" style="position: relative;" indepth="true"><img style="position: relative; left: -5px;" src="images/logo.png" alt="聚合数据"></a>
    <div class="centerSearch">
        <input class="searchText" name="q" placeholder="搜索" value="" type="text">
        <button id="searchBtn" type="button" class="searchBtn centerIcon"></button>
    </div>
    <ul class="headerUl clearfix">
        <li class="headerLi1">
            <div class="headerInfo"><span>zmc2585</span><i class="headerIcon1 centerIcon"></i></div>
            <a class="centerLogout" href="javascript:logout();">退出登录</a>
        </li>
        <li>
            <a href="qa.html" target="_top" indepth="true">常见问题</a>
        </li>
        <li class="headerLi3">
            <div class="headerFoucs"><span>关注聚合</span><i class="headerIcon1 centerIcon"></i></div>
            <div class="juheCode">
                <span class="centerIcon"></span>
            </div>
        </li>
        <li>
            <a class="headerContact" href="contact.html" target="_top" indepth="true">联系我们</a>
        </li>
    </ul>
</header>

    <div id="ucenterWrapper" class="ucenterWidth1 clearfix">
        <nav>
    <ul class="ucenterNav">
        <li class="navIndex ">
            <div class="navDiv">
                <a href="index.html" indepth="true"><i class="iconfont"></i>我的聚合</a>
            </div>
        </li>
        <li class="active">
            <div class="navDiv">
                <a href="mydata.html" indepth="true"><i class="iconfont"></i>我的数据</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="myactivity.html" indepth="true"><i class="iconfont"></i>我的活动</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="mycollection.html" indepth="true"><i class="iconfont"></i>我的收藏</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="ipconfig.html" indepth="true"><i class="iconfont"></i>IP白名单</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="money.html" indepth="true"><i class="iconfont"></i>我的余额</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="paylogs.html" indepth="true"><i class="iconfont"></i>我的充值记录</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="purchaselogs.html" indepth="true"><i class="iconfont"></i>我的消费记录</a>
            </div>
        </li>
        <li class="">
            <div class="navDiv">
                <a href="workorder.html" indepth="true"><i class="iconfont"></i>我的工单</a>
            </div>
        </li>
                <li class="navInfoLi">
            <span id="ucenterSubA"><i class="iconfont"></i>用户中心<i class="centerIcon subDown"></i></span>
            <ul class="ucenterSub">
                <li class=""><a href="accountinfo.html" indepth="true"><i class="iconfont"></i>账户信息</a></li>
                <li class=""><a href="editpwd.html" indepth="true"><i class="iconfont"></i>密码修改</a></li>
                <li class=""><a href="certify.html" indepth="true"><i class="iconfont"></i>实名认证</a></li>
                <li>&nbsp;</li>
            </ul>
        </li>
    
    </ul>
</nav>

        <section id="ucenterSection">
            <h2 class="centerTitle">
                <a class="titleA" href="mydata.html" indepth="true">我的数据</a>
                <i>&nbsp;&gt;</i>
                <span>购买数据</span>
            </h2>
            <div class="buyDataContent rightBackground">
                <h1 class="buyTitle">
                    <img src="images/a61.png" alt="语音验证码">
                    <span>语音验证码</span>
                </h1>
                                <input name="urlPkgId" value="" type="hidden">
<form action="https://www.juhe.cn/recharge/buy" method="post" class="buyDataForm clearfix" target="_blank">
    <input name="applyId" value="396396" type="hidden">
    <input name="pkgId" value="738" type="hidden">
    <input name="did" value="61" type="hidden">
    <ul class="centerFormUl">
        <li class="clearfix buyDataLi">
            <label class="labelLeft">选择套餐：</label>
            <ul class="packageUl floatLeft">
                                <li class="active" data-package-price="499.00" data-package-id="738" data-package-renums="10000">
                    发展套餐（￥499.00/10000次）
                </li>
                                <li class="" data-package-price="99.00" data-package-id="737" data-package-renums="1600">
                    起步套餐（￥99.00/1600次）
                </li>
                            </ul>
        </li>
        <li class="clearfix buyDataLi">
            <label class="labelLeft">套餐次数：</label>
            <div class="labelRight">
                <span><i id="pkgTimes">10000</i>次</span>
            </div>
        </li>
        <li class="clearfix buyDataLi">
            <label class="labelLeft">购买数量：</label>
            <div class="labelRight">
                <input name="pkgNums" min="1" max="1000" class="buyDataNum inputText" value="1" type="number">
                <i class="errorTips numError"><span class="iconfont" id="isNaNSpan"></span><em id="isNaNem">购买数量必须是正整数</em></i>
            </div>
        </li>
                <li class="clearfix buyDataLi">
            <label class="labelLeft">应付金额：</label>
            <div class="labelRight">
                <span class="buyMymoney buyMyYue" style="color: rgb(254, 81, 68); font-size: 20px; font-weight: bold;">￥<i id="money">499</i></span>
                <input name="" value="" type="hidden">
            </div>
        </li>
        <!--<li class="clearfix buyDataLi">
            <label class="labelLeft">账户余额：</label>
            <div class="labelRight">
                <span class="buyMymoney buyMyYue">￥0.00</span>
                <input type="hidden" name="" value="" />
                <i class="errorTips" ><span class="iconfont" id="yuespan">&#xe604;</span><em id="yueem">余额不足</em><a class="changedBtn" href="/money" id="quchongzhi">去充值</a></i>
            </div>
        </li>-->
        <li class="clearfix buyDataLi">
            <label class="labelLeft">支付方式：</label>
            <div class="labelRight">
                <label><input name="chargeType" value="1" type="radio">&nbsp;&nbsp;<img src="images/buybao.png"></label>&nbsp;&nbsp;&nbsp;&nbsp;
                <label><input name="chargeType" value="0" checked="checked" type="radio">&nbsp;&nbsp;余额支付(<span class="buyMymoney buyMyYue">￥0.00</span>)</label>
                <input name="" value="" type="hidden">
                <i class="errorTips"><span class="iconfont" id="yuespan"></span><em id="yueem">余额不足, </em><a class="changedBtn" href="/money" id="quchongzhi">去充值</a></i>
            </div>
        </li>
        <li class="clearfix buyDataLi">
            <label class="labelLeft">&nbsp;</label>
            <div class="labelRight">
                <button type="button" class="centerBtn fourBtn">确认购买</button>
                <i class="errorTips"></i>
            </div>
        </li>
    </ul>
    <dl class="buyDesDl">
        <dt>购买说明：</dt>
        <dd>如需更多的请求次数、更优惠的价格请与我们联系</dd>
        <dd>如果您没有支付宝，您可以联系我们的商务进行线下充值，确认到账后我们将会为您开通相应的数据服务</dd>
        <dd style="padding-top: 5px;">在线客服：&nbsp; <a rel="nofollow" class="iconfont" href="http://crm2.qq.com/page/portalpage/wpa.php?uin=800076065&amp;f=1&amp;ty=1&amp;aty=0&amp;a=&amp;from=6" target="_top"></a></dd>
        <dd>&nbsp;</dd>
        <dd><font color="#fe514a">* 数据API在成功申请日起，需要在2个月内提交认证审核，否则将不能正常请求数据，直到审核通过！</font></dd>
        <dd><font color="#fe514a">* 如需要延长审核期限，请于工作日与我们的在线客服联系！</font></dd>
    </dl>
</form>
<div id="payQuestion" hidden="true">
    <div class="payQuestion centerlayerDiv">
        <h3 class="layerTitle">
            <span>支付宝在线充值</span>
            <a class="layerCloseA iconfont" href="javascript:void(0);"></a>
        </h3>
        <div class="layerContent">
            <p><font color="#03c5ff"><i class="iconfont"></i></font>请在新页面完成充值</p>
            <button type="button" class="centerBtn paySuccess">充值成功</button>&nbsp;&nbsp;
            <button type="button" class="centerBtn payFailed inputBtn">遇到问题</button>
        </div>
</div>

                            </div>
        </div></section>
    </div>
<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ucenterpublic.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/layer.js" type="text/javascript" charset="utf-8"></script>
<script src="js/json.parse.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery.form.js" type="text/javascript" charset="utf-8"></script>
<script src="js/nslog.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    $(document).ready(function(){
        //ucenter 统一使用的提交方式:ajaxsubmit,所以当用户登录失效的时候无法跳转到指定页面,
        //添加下面对button 按钮的监视,如果为失效继续下面动作,如果点击按钮的时候登录失效了,就跳转到指定页面,如登录页面
        $('.ajax-check-login,button,input:button').click(function(event){
            var login = true;
            $.getJSON('/login/loginStatus',function(obj){
                if(obj.code=='-1')
                {
                    if(self == top){
                        window.location.href = obj.acturl;
                    }else{
                        parent.window.location.reload();
                    }

                    login = false;
                }
            })

            if(!login)
            {
                event.stopImmediatePropagation();
            }
        })

    })
    // 退出登录
    function logout(){
        $.getJSON('/login/logout',function(obj){
            window.location.href='/';
        })
    }

    $("input[name=q]").focus(function(){
        document.onkeydown = function(e){
            var ev = document.all ? window.event : e;
            if(ev.keyCode==13) {
                $("#searchBtn").click();
            }
        }
    })

    // header里的搜索框
    $("#searchBtn").click(function(){
        var q = $("input[name=q]").val();
        q=q.replace(/\//g,'');

        if(q.length==''){
            $("input[name=q]").focus();
            return false;
        }

        var searchUrl = '/docs/s/q/%40q%40';
        searchUrl=searchUrl.replace(/%40q%40/,encodeURIComponent(q));
        window.location.href=searchUrl;
    })

    $(document).ready(function(){

        $("input[name=q]").focus(function(){
            document.onkeydown = function(e){
            var ev = document.all ? window.event : e;
                if(ev.keyCode==13) {
                    $("#searchBtn").click();
                }
            }
        })
    })

    function isMobile(mobile){
        var mreg =/^1[3|5|8|4|7]{1}[0-9]{1}[0-9]{8}$/;
        if(!mreg.test(mobile)){
            return false;
        }
        return true;
    }

    $('a[href="http://crm2.qq.com/page/portalpage/wpa.php?uin=800076065&f=1&ty=1&aty=0&a=&from=6"]').bind('click',function(){
        nslog(1121);
    });
</script>

<script type="text/javascript">
    $(function(){

        var urlPkgId = $(':input[name=urlPkgId]').attr('value') || 'aa';
        var did = $(':input[name=did]').attr('value');

        // 发生input事件时，隐藏所有错误提示
        $(':input').on('input', function(){
            $('.errorTips').hide();
        })

        // 点击套餐时
        $('.packageUl li').click(function(){
            var pkgId = $(this).attr('data-package-id');
            var pkgNums = $(':input[name=pkgNums]').val();


            // 每个套餐对应的可用优惠券不同，所以需要获取本套餐可用的优惠券
            url = "/recharge/availableyhq/inside/0/pid/%40pid%40/count/%40count%40/did/%40did%40";
            url = url.replace('%40pid%40', pkgId)
                .replace('%40count%40', pkgNums)
                .replace('%40did%40', did);
            $.ajaxSettings.async = false;
            $.getJSON(url, function(json){
                if ('0' != json.code || !json.data) {
                    if ($('li').hasClass('yhqList')) {
                        $('li.yhqList').remove();
                    }
                } else {
                    if ($('li').hasClass('yhqList')) {
                        $(':input[name=yhq]').html('<option value="0" ctype="0">请选择优惠劵</option>');
                    } else {
                        $(':input[name=pkgNums]').parents('li').after(
                            '<li class="clearfix buyDataLi yhqList">'+
                                '<label class="labelLeft">优惠选择：</label>'+
                                '<div class="labelRight">'+
                                    '<select class="inputText" name="yhq">'+
                                        '<option value="0" ctype="0">请选择优惠劵</option>'+
                                    '</select>'+
                                '</div>'+
                            '</li>'
                        );
                    }
                    for (i in json.data) {
                        $(':input[name=yhq]').append(
                            '<option value="'
                            +json.data[i].cardno
                            +'" cvalue="'
                            +json.data[i].cvalue
                            +'" ctype="'
                            +json.data[i].type
                            +'" >'
                            +json.data[i].cardname
                            +'</option>');
                    }
                }
            })

            $('.packageUl li').removeClass('active');
            $(this).attr('class','active');

            $(":input[name='pkgId']").attr('value',pkgId);// 设置要购买的pkgId

            setTotal(); // 结算费用
        });

        // 优惠券的选择、套餐数量的选择发生变化时
//        $(':input[name=yhq], :input[name=pkgNums]').change(function(){
//            setTotal();
//        })

        $('.centerFormUl').on('change',':input[name=yhq], :input[name=pkgNums]',function(){
            setTotal();
        })

        $(".buyDataNum").focus(function(){
            $(this).keypress( function(e) {
                var key = window.event ? e.keyCode : e.which;
                if(key.toString() == "13"){
                    return false;
                }
            })
        })

        // 点击确定购买按钮时
        $("form button.centerBtn").click(function(){
            var chargeType = $('input:radio[name=chargeType]:checked').val();
            if(chargeType == '1'){
                var pkgNums = $(":input[name=pkgNums]").val();
                if (pkgNums<1 || pkgNums>1000) {
                    $(':input[name=pkgNums]').siblings('.errorTips').html('购买数量应为1到1000之间').show();
                    return false;
                }
                layer.open({
                    type: 1,
                    title: false,
                    closeBtn: 0,
                    skin: 'layui-layer-rim', //加上边框
                    area: ['402px', '282px'], //宽高
                    content: $('#payQuestion').html()
                });
                $(".buyDataForm").submit();
            }else{
                $(this).parents('form').ajaxSubmit(function(json){
                    json = json_parse(json);
                    if ('1' == json.code) {
                        layer.msg(json.msg, {
                            time: 3000,shade:0.1
                        }, function(){
                            url = '/myData/buyDetail/id/%40id%40';
                            url = url.replace('%40id%40','396396');
                            window.location = url;
                        });
                    } else if ('-8' == json.code) {
                        $(':input[name=pkgNums]').siblings('.errorTips').html(json.msg).show();
                    } else if ('99' == json.code){
                        //openwin(json.payUrl);
                    } else {
                        $("form button.centerBtn").siblings('.errorTips').html(json.msg).show();
                    }
                })
            }
        });

        // 默认选第一个套餐
        $('.packageUl li:first').click();
        $('.packageUl li[data-package-id=' + urlPkgId + ']').click();

        // 支付宝在线充值的弹窗中的关闭按钮
        $('body').on('click', '.layerCloseA', function(){
            layer.closeAll();
        })

        // 支付宝在线充值的弹窗中的两个按钮
        $('body').on('click', '.payQuestion .paySuccess', function(){
            window.location.reload();
        }).on('click', '.payQuestion .payFailed', function(){
            //window.location = '/qa';
            layer.closeAll();
            openwin('/qa');
        })

        nslog(1150, window.location.href, {
            did: did
        });
    });

    function isPInt(str) {
        var g = /^[1-9]*[1-9][0-9]*$/;
        return g.test(str);
    }

    function openwin(url) {
        var a = document.createElement("a");
        a.setAttribute("href", url);
        a.setAttribute("target", "_blank");
        a.setAttribute("id", "openwin");
        document.body.appendChild(a);
        a.click();
    }

    /**
     * 计算最终费用
     */
    function setTotal() {
        var yue = '0.00';
        var did = $(':input[name=did]').attr('value');
        var yhqType = $(':input[name=yhq]').find('option:selected').attr('ctype'); // 券类型
        var cvalue = $(':input[name=yhq]').find('option:selected').attr('cvalue'); // 券值
        var pkgNums = $(":input[name=pkgNums]").val(); // 购买数量
        var price = $('.packageUl li.active').attr("data-package-price"); // 单价
        var total = price * pkgNums; // 总价
        var totalDiscount = total; // 折扣后的总价
        var yhq = $(':input[name=yhq]').val();

        if (yhq) {
            if ('1' == yhqType) {
                // 折扣券
                totalDiscount = Math.round(total*cvalue*100)/100;
                $('#money').html(totalDiscount);
            } else if ('2' == yhqType) {
                // 现金券
                totalDiscount = total-cvalue;
                if (totalDiscount < 0) {
                    totalDiscount = 0;
                }
                $('#money').html(totalDiscount);
            } else if ('0' == yhqType) {
                // 未选择优惠券
                totalDiscount = total;
            } else {
                totalDiscount = total;
                layer.alert('未知的优惠券类型，请联系客服');
            }
        }

        $('#money').html(totalDiscount);
        $("#pkgTimes").html($('.packageUl li.active').attr("data-package-renums")*pkgNums);// 套餐次数改变

        // 判断应付金额和余额的关系
        if (yue < parseFloat(totalDiscount)) {
            $("#yuespan").html("&#xe604;");
            $("#yueem").html("余额不足, ");
            $("#quchongzhi").html("去充值").attr("href","/money");
        }
    }

</script>





</body></html>
