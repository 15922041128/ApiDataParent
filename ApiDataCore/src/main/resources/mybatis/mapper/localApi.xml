<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.pbccrc.api.core.mapper.LocalApiMapper">

	<resultMap id="localApiResult" type="org.pbccrc.api.base.bean.LocalApi">
		<result property="id" column="id"/>
		<result property="service" column="service"/>
		<result property="tblName" column="tblName"/>
		<result property="apiName" column="apiName"/>
		<result property="queryType" column="queryType"/>
		<result property="returnType" column="returnType"/>
		<result property="url" column="url"/>
		<result property="params" column="params"/>
		<result property="returnParam" column="returnParam" javaType="java.lang.String" jdbcType="CLOB" typeHandler="org.pbccrc.api.core.dao.util.OracleClobTypeHandler"/>
		<result property="costCondition" column="costCondition"/>
		<result property="basePrice" column="basePrice"/>
		<result property="isOpen" column="isOpen"/>
		<result property="createDate" column="createDate"/>
		<result property="stopDate" column="stopDate"/>
	</resultMap>
	
	<select id="queryByService" parameterType="java.lang.String" resultMap="localApiResult">
		select * from localApi where service = #{service}
	</select>
	
	<select id="queryAll" resultMap="localApiResult">
		select * from localApi
	</select>
	
	<select id="queryApiByPage" parameterType="org.pbccrc.api.base.bean.LocalApi" resultType="org.pbccrc.api.base.bean.LocalApi">
		select * from localApi where 1=1
			<if test="apiName !=null and apiName != '' ">
            	and apiName like CONCAT('%',#{apiName},'%') 
        	</if>
        	<if test="tblName !=null and tblName != '' ">
            	and tblName like CONCAT('%',#{tblName},'%') 
        	</if>
			<if test="service !=null and service != '' ">
            	and service like CONCAT('%',#{service},'%') 
        	</if>
        	<if test="isOpen !=null and isOpen != '' ">
            	and isOpen = #{isOpen}
        	</if>
	</select>
	
	<select id="isExist" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) from localApi where service = #{service}
	</select>
	
	<insert id="addLocalApi" keyProperty="id" parameterType="org.pbccrc.api.base.bean.LocalApi">
		insert into localApi(apiName, service, tblName, queryType, url, params, returnType, returnParam, costCondition, basePrice, isOpen, createDate, stopDate) 
			values(#{apiName}, #{service}, #{tblName}, #{queryType}, #{url}, #{params}, #{returnType}, #{returnParam}, #{costCondition}, #{basePrice}, #{isOpen}, #{createDate}, #{stopDate})
	</insert>
	
	<update id="updateLocalApi" parameterType="org.pbccrc.api.base.bean.LocalApi">
		update localApi
		<set>  
			<if test="apiName !=null and apiName != '' ">
            	apiName = #{apiName},
        	</if>
        	<if test="service !=null and service != '' ">
            	service = #{service},
        	</if>
        	<if test="tblName !=null and tblName != '' ">
            	tblName = #{tblName},
        	</if>
        	<if test="url !=null and url != '' ">
            	url = #{url},
        	</if>
        	<if test="params !=null and params != '' ">
            	params = #{params},
        	</if>
        	<if test="queryType !=null and queryType != '' ">
            	queryType = #{queryType},
        	</if>
        	<if test="returnType !=null and returnType != '' ">
            	returnType = #{returnType},
        	</if>
        	<if test="returnParam !=null and returnParam != '' ">
            	returnParam = #{returnParam},
        	</if>
        	<if test="costCondition !=null and costCondition != '' ">
            	costCondition = #{costCondition},
        	</if>
        	<if test="basePrice !=null and basePrice != '' ">
            	basePrice = #{basePrice},
        	</if>
        	<if test="isOpen !=null and isOpen != '' ">
            	isOpen = #{isOpen},
        	</if>
        	<if test="createDate !=null and createDate != '' ">
            	createDate = #{createDate},
        	</if>
        	<if test="stopDate !=null and stopDate != '' ">
            	stopDate = #{stopDate},
        	</if>
        </set>
        <where>
			id = #{id}
		</where>	
		
	</update>
	
</mapper>